<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGL中获取指定xOy位置颜色</title>

    <!-- 顶点着色器 -->
    <script type='x-shader/x-vertex' id='vs'>
        void main(){
            gl_Position=vec4(0.0,0.0,0.0,1.0);
            gl_PointSize=100.0;
        }
    </script>

    <!-- 片段着色器 -->
    <script type='x-shader/x-fragment' id='fs'>
        void main(){

            // rgba(51, 153, 0, 255)
            // 温馨提示：如果255*value不是整数，后续获取的时候会四舍五入
            gl_FragColor=vec4(0.2,0.6,0.0,1.0);
        }
    </script>

</head>

<body>

    <canvas width=200 height=200 style="outline:1px solid gray;">
        非常抱歉，您的浏览器不支持canvas!
    </canvas>

    <script>

        // 先获取gl
        var gl = document.getElementsByTagName('canvas')[0].getContext('webgl');

        // 定义一个把着色器字符串加载成着色器对象的函数
        var loadShader = function (type, source) {

            // 创建着色器对象
            var shader = gl.createShader(type);

            // 绑定资源
            gl.shaderSource(shader, source);

            // 编译着色器
            gl.compileShader(shader);

            return shader;
        };

        // 分别加载顶点着色器对象和片段着色器对象
        var vertexShader = loadShader(gl.VERTEX_SHADER, document.getElementById('vs').innerHTML),
            fragmentShader = loadShader(gl.FRAGMENT_SHADER, document.getElementById('fs').innerHTML);

        // 创建一个着色器程序
        var glProgram = gl.createProgram();

        // 把前面创建的两个着色器对象添加到着色器程序中
        gl.attachShader(glProgram, vertexShader);
        gl.attachShader(glProgram, fragmentShader);

        // 把着色器程序链接成一个完整的程序
        gl.linkProgram(glProgram);

        // 使用这个完整的程序
        gl.useProgram(glProgram);

        // 绘制一个点
        gl.drawArrays(gl.POINTS, 0, 1);

        /**
         * ------------------------------
         * 下面开始是实验代码
        */

        var pixels = new Uint8Array(
            4 * gl.drawingBufferWidth * gl.drawingBufferHeight
        );
        var x = 100;
        var y = 100;
        gl.readPixels(
            0,
            0,
            gl.drawingBufferWidth,
            gl.drawingBufferHeight,
            gl.RGBA,
            gl.UNSIGNED_BYTE,
            pixels
        );

        var pixelR = pixels[4 * (y * gl.drawingBufferWidth + x)];
        var pixelG = pixels[4 * (y * gl.drawingBufferWidth + x) + 1];
        var pixelB = pixels[4 * (y * gl.drawingBufferWidth + x) + 2];
        var pixelA = pixels[4 * (y * gl.drawingBufferWidth + x) + 3];

        console.log("rgba(" + pixelR + ", " + pixelG + ", " + pixelB + ", " + pixelA + ")");

    </script>

</body>

</html>